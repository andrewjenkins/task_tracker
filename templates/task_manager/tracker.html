{% extends "task_manager/base.html" %}
{% block head %}
    <script type="text/javascript">
         $( function() {
            $( ".list" ).sortable({
                revert: true,
                connectWith: '.list',
                update: function (event, ui) {
                    var data = {
                        "items": $(this).sortable('serialize'),
                        "csrfmiddlewaretoken": "{{ csrf_token }}"
                    };

                    $.ajax({
                        data: data,
                        type: 'POST',
                        url: '{% url 'order_items' %}'
                    });
                }
            });
            $( ".item" ).disableSelection();
         });
    </script>
{% endblock %}

{% block content %}
    {% for group in groups %}
    <div class="group ui card">
        <div class="content">
            <div class="header">{{ group.name|striptags }}</div>
            <div class="description">
                <div class="ui list">
                    {% for item in group.item_set.all %}
                    <div id="item_{{ item.id }}" class="ui item segment">{{ item.content|striptags }}</div>
                    {% endfor %}
                    <div class="item">
                        <form action="{% url 'add_item' %}" class="ui action input" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="group_id" value="{{ group.id }}" />
                            <input type="text" name="content" placeholder="Add a new item..."/>
                            <button class="ui icon button">
                                <i class="plus icon"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!--<div class="extra content">
            TODO: add options to delete group
        </div>-->
    </div>
    {% endfor %}
    <div class="group ui card">
        <div class="content">
            <div class="description">
                <form action="{% url 'add_group' %}" class="ui action input" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="board_id" value="{{ board.id }}" />
                    <input type="text" name="group_name" placeholder="Add a new group..." maxlength="64" />
                    <button class="ui icon button">
                        <i class="plus icon"></i>
                    </button>
                </form>
            </div>
        </div>
        <!--<div class="extra content">
            TODO: add options to delete group
        </div>-->
    </div>
{% endblock %}